$(function(){
  var lucendia = document.getElementById("SecondsUntilExpire");
  var IDLE_TIMEOUT = parseInt($(lucendia).data('expiry')) || 5000;
  var _idleSecondsTimer = null;
  var _idleSecondsCounter = 0;
  document.onclick = function () {
    _idleSecondsCounter = 0;
  };
  document.onmousemove = function () {
    _idleSecondsCounter = 0;
  };
  document.onkeypress = function () {
    _idleSecondsCounter = 0;
  };
  _idleSecondsTimer = window.setInterval(CheckIdleTime, 1e3);
  function CheckIdleTime() {
    _idleSecondsCounter++;
    if (lucendia) {
      lucendia.innerHTML = IDLE_TIMEOUT - _idleSecondsCounter + "";
    }
    ;
    if (_idleSecondsCounter >= IDLE_TIMEOUT) {
      window.clearInterval(_idleSecondsTimer);
      $.ajax({url: "logout.php", data: "action=logout", type: "POST", async: true, success: function (armaya) {
        if (armaya == "success") {
          swal({title: "Warning!", text: "Your session has expired. Please log in again.", type: "warning", showCancelButton: false, confirmButtonColor: "#DD6B55", confirmButtonText: "Login again", closeOnConfirm: true}, function (doras) {
            if (doras) {
              document.location.href = "logout.php?action=timeout";
            }
          });
        }
      }, error: function (huxton, mutsuo) {
        swal("Cancelled", "Error occured during the process. Please try again.", "error");
      }});
    }
  }
});
